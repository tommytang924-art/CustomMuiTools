{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tommytang/Documents/myproject/muitools/src/components/layout/Drawer.tsx"],"sourcesContent":["// Drawer.tsx\r\n\"use client\"\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { openDrawer, closeDrawer } from \"@/lib/redux/reducers/Slice/drawerSlice\"\r\nimport { RootState } from \"@/lib/redux/store/store\";\r\nimport { signOut, useSession } from \"next-auth/react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nimport { styled } from '@mui/material/styles';\r\nimport Box from '@mui/material/Box';\r\nimport Drawer from '@mui/material/Drawer';\r\nimport MuiAppBar from '@mui/material/AppBar';\r\nimport Toolbar from '@mui/material/Toolbar';\r\nimport List from '@mui/material/List';\r\nimport Divider from '@mui/material/Divider';\r\nimport ListItem from '@mui/material/ListItem';\r\nimport ListItemButton from '@mui/material/ListItemButton';\r\nimport ListItemText from '@mui/material/ListItemText';\r\nimport IconButton from '@mui/material/IconButton';\r\nimport MenuIcon from '@mui/icons-material/Menu';\r\nimport Avatar from '@mui/material/Avatar';\r\nimport Logout from '@mui/icons-material/Logout';\r\nimport Collapse from '@mui/material/Collapse';\r\nimport ExpandLess from '@mui/icons-material/ExpandLess';\r\nimport ExpandMore from '@mui/icons-material/ExpandMore';\r\nimport { Button, Dialog, DialogActions, DialogContent, DialogContentText, DialogTitle } from \"@mui/material\";\r\nimport { getToken } from \"next-auth/jwt\";\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst Main = styled('main', { shouldForwardProp: (prop) => prop !== 'open' })<{\r\n  open?: boolean;\r\n}>(({ theme, open }) => ({\r\n  flexGrow: 1,\r\n  padding: 0,\r\n  backgroundColor: '#fff',\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  marginLeft: `-${drawerWidth}px`,\r\n  minHeight: '100vh',\r\n  width: '100%', // Essential base\r\n  ...(open && {\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n    marginLeft: 0,\r\n    width: `calc(100% - ${drawerWidth}px)`, // This prevents overflow!\r\n  }),\r\n}));\r\n\r\nconst AppBar = styled(MuiAppBar, {\r\n  shouldForwardProp: (prop) => prop !== 'open',\r\n})<{ open?: boolean }>(({ theme, open }) => ({\r\n  transition: theme.transitions.create(['margin', 'width'], {\r\n    easing: theme.transitions.easing.sharp,\r\n    duration: theme.transitions.duration.leavingScreen,\r\n  }),\r\n  ...(open && {\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    marginLeft: `${drawerWidth}px`,\r\n    transition: theme.transitions.create(['margin', 'width'], {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  }),\r\n}));\r\n\r\nconst DrawerHeader = styled('div')(({ theme }) => ({\r\n  display: 'flex',\r\n  alignItems: 'center',\r\n  padding: theme.spacing(0, 1),\r\n  minHeight: 64,\r\n  justifyContent: 'center',\r\n  fontSize:\"18px\"\r\n}));\r\n\r\nexport default function AppDrawer({ children }: { children?: React.ReactNode }) {\r\n  const dispatch = useDispatch();\r\n  const isOpen = useSelector((state: RootState) => state.Drawer.isOpen);\r\n  const mainMenu = useSelector((state: RootState) => state.Drawer.mainMenu);\r\n  const subMenu = useSelector((state: RootState) => state.Drawer.subMenu);\r\n  const router = useRouter();\r\n  const { data: session } = useSession();\r\n  const isAuthenticated = session;\r\n  const MenuTitle = \"Mui tools Portal\";\r\n  const sysuserId = session?.user?.sysuserId || '';\r\n  const userInitial = sysuserId ? sysuserId.charAt(0).toUpperCase() : '';\r\n\r\n  // Track expanded state per main menu (using string menu_id)\r\n  const [expandedIds, setExpandedIds] = useState<Set<string>>(new Set());\r\n\r\n  const toggleDrawer = () => {\r\n    isOpen ? dispatch(closeDrawer()) : dispatch(openDrawer());\r\n  };\r\n\r\n  const handleNavigation = (path: string) => {\r\n    router.push(path);\r\n\r\n  };\r\n\r\n  const toggleExpand = (menuId: string) => {\r\n    setExpandedIds(prev => {\r\n      const next = new Set(prev);\r\n      if (next.has(menuId)) next.delete(menuId);\r\n      else next.add(menuId);\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const [open, setOpen] = React.useState(false);\r\n\r\n  const handleClickOpen = () => {\r\n    setOpen(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const intervalId = setInterval(() => {\r\n      if (!isAuthenticated) {\r\n        handleClickOpen()\r\n      }\r\n    }, 5000);\r\n    return () => {\r\n      clearInterval(intervalId);\r\n    };\r\n  }, [session]);\r\n\r\n  const handleRedirectLogin = () => {\r\n    router.push('/');\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Dialog\r\n        open={open}\r\n        aria-labelledby=\"alert-dialog-title\"\r\n        aria-describedby=\"alert-dialog-description\"\r\n      >\r\n        <DialogTitle id=\"alert-dialog-title\">\r\n          {\"Session Expired\"}\r\n        </DialogTitle>\r\n        <DialogContent>\r\n          <DialogContentText id=\"alert-dialog-description\">\r\n            Your session is expired. Please login again\r\n          </DialogContentText>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleRedirectLogin} autoFocus>\r\n            Go to Login Page\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <Box sx={{ display: 'flex' }}>\r\n        <AppBar\r\n          position=\"fixed\"\r\n          open={isOpen}\r\n          elevation={0}\r\n          sx={{\r\n            backgroundColor: \"snow\",\r\n            borderBottom: \"1px solid #e0e0e0\",\r\n            backdropFilter: \"blur(8px)\",\r\n            color: \"text.primary\"\r\n          }}\r\n        >\r\n          <Toolbar sx={{ justifyContent: \"space-between\", minHeight: { xs: 56, sm: 64 } }}>\r\n            {/* Left: Hamburger Menu */}\r\n            <IconButton\r\n              color=\"inherit\"\r\n              aria-label=\"open drawer\"\r\n              onClick={toggleDrawer}\r\n              edge=\"start\"\r\n              size=\"large\"\r\n              sx={{ color: \"black\" }}\r\n            >\r\n              <MenuIcon />\r\n            </IconButton>\r\n            {/* Right: Logout and User Icon */}\r\n\r\n            <Box sx={{ display: \"flex\", alignItems: \"center\", gap: 1.5 }}>\r\n              {isAuthenticated && (\r\n                <Avatar\r\n                  sx={{\r\n                    bgcolor: 'rgba(201, 218, 140, 1)',\r\n                    color: 'rgba(40, 43, 46, 1)',\r\n                    width: 36,\r\n                    height: 36,\r\n                    fontSize: '1rem',\r\n\r\n                  }}\r\n                >\r\n                  {userInitial}\r\n                </Avatar>\r\n              )}\r\n              <IconButton color=\"inherit\" onClick={() => signOut({ callbackUrl: '/pds' })}>\r\n                <Logout />\r\n              </IconButton>\r\n            </Box>\r\n\r\n          </Toolbar>\r\n        </AppBar>\r\n\r\n        {/* Menu */}\r\n        <Drawer\r\n          sx={{\r\n            width: drawerWidth,\r\n            flexShrink: 0,\r\n            '& .MuiDrawer-paper': {\r\n              width: drawerWidth,\r\n              backgroundImage: \"linear-gradient(180deg, rgba(186, 209, 104, 1), rgba(185, 68, 78, 0.8))\",\r\n              color: \"#fff\",\r\n              boxSizing: 'border-box',\r\n      \r\n            },\r\n          }}\r\n          variant=\"persistent\"\r\n          anchor=\"left\"\r\n          open={isOpen}\r\n          ModalProps={{ keepMounted: true }}\r\n        >\r\n          <DrawerHeader sx={{ backgroundColor: \"rgba(170, 202, 55, 0.26)\", fontWeight: \"bold\" }}>\r\n            {MenuTitle}\r\n          </DrawerHeader>\r\n          <Divider sx={{ borderColor: 'rgba(255,255,255,0.12)' }} />\r\n\r\n          <List sx={{ color: \"#fff\", flexGrow: 1, p: 0, \r\n            '& .MuiTypography-root' :{\r\n              fontSize:\"16px\"\r\n            }\r\n\r\n          }}>\r\n            {mainMenu.map((main) => {\r\n              const menuId = String(main.menu_id);\r\n              const subs = subMenu.filter(sub => String(sub.parent_id) === menuId);\r\n              const hasChildren = subs.length > 0;\r\n              const isExpanded = expandedIds.has(menuId);\r\n\r\n              return (\r\n                <React.Fragment key={menuId}>\r\n                  {/* Main Menu Item */}\r\n                  <ListItem disablePadding>\r\n                    <ListItemButton\r\n                      onClick={() => {\r\n                        if (hasChildren) {\r\n                          toggleExpand(menuId);\r\n                        } else {\r\n                          handleNavigation(main.uri);\r\n                        }\r\n                      }}\r\n                      sx={{\r\n                        '&:hover': {\r\n                          backgroundColor: 'rgba(255, 255, 255, 0.1)',\r\n                        },\r\n                      }}\r\n                    >\r\n\r\n                      <ListItemText primary={main.menu_name} />\r\n                      {hasChildren && (\r\n                        isExpanded ? <ExpandLess /> : <ExpandMore />\r\n                      )}\r\n                    </ListItemButton>\r\n                  </ListItem>\r\n\r\n                  {/* Submenu with Collapse */}\r\n                  {hasChildren && (\r\n                    <Collapse in={isExpanded} timeout=\"auto\" unmountOnExit>\r\n                      <List disablePadding>\r\n                        {subs.map((sub) => (\r\n                          <ListItem key={sub.menu_id} disablePadding>\r\n                            <ListItemButton\r\n                              sx={{\r\n                                pl: 5,\r\n                                '&:hover': {\r\n                                  backgroundColor: 'rgba(255, 255, 255, 0.15)', // Full-width hover\r\n                                },\r\n                                justifyContent: 'flex-start',\r\n                              }}\r\n                              onClick={() => handleNavigation(sub.uri)}\r\n                            >\r\n                              <ListItemText primary={sub.menu_name} />\r\n                            </ListItemButton>\r\n                          </ListItem>\r\n                        ))}\r\n                      </List>\r\n                    </Collapse>\r\n                  )}\r\n                </React.Fragment>\r\n              );\r\n            })}\r\n          </List>\r\n\r\n          {/* User & Logout Section */}\r\n\r\n        </Drawer>\r\n\r\n        <Main open={isOpen}>\r\n          <Box sx={{ minHeight: 64 }} />\r\n          {children}\r\n        </Main>\r\n      </Box>\r\n    </>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AA1BA,aAAa;AACb;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA,MAAM,cAAc;AAEpB,MAAM,OAAO,IAAA,2NAAM,EAAC,QAAQ;IAAE,mBAAmB,CAAC,OAAS,SAAS;AAAO,GAExE,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,GAAK,CAAC;QACvB,UAAU;QACV,SAAS;QACT,iBAAiB;QACjB,YAAY,MAAM,WAAW,CAAC,MAAM,CAAC;YAAC;YAAU;SAAQ,EAAE;YACxD,QAAQ,MAAM,WAAW,CAAC,MAAM,CAAC,KAAK;YACtC,UAAU,MAAM,WAAW,CAAC,QAAQ,CAAC,aAAa;QACpD;QACA,YAAY,CAAC,CAAC,EAAE,YAAY,EAAE,CAAC;QAC/B,WAAW;QACX,OAAO;QACP,GAAI,QAAQ;YACV,YAAY,MAAM,WAAW,CAAC,MAAM,CAAC;gBAAC;gBAAU;aAAQ,EAAE;gBACxD,QAAQ,MAAM,WAAW,CAAC,MAAM,CAAC,OAAO;gBACxC,UAAU,MAAM,WAAW,CAAC,QAAQ,CAAC,cAAc;YACrD;YACA,YAAY;YACZ,OAAO,CAAC,YAAY,EAAE,YAAY,GAAG,CAAC;QACxC,CAAC;IACH,CAAC;AAED,MAAM,SAAS,IAAA,2NAAM,EAAC,uKAAS,EAAE;IAC/B,mBAAmB,CAAC,OAAS,SAAS;AACxC,GAAuB,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,GAAK,CAAC;QAC3C,YAAY,MAAM,WAAW,CAAC,MAAM,CAAC;YAAC;YAAU;SAAQ,EAAE;YACxD,QAAQ,MAAM,WAAW,CAAC,MAAM,CAAC,KAAK;YACtC,UAAU,MAAM,WAAW,CAAC,QAAQ,CAAC,aAAa;QACpD;QACA,GAAI,QAAQ;YACV,OAAO,CAAC,YAAY,EAAE,YAAY,GAAG,CAAC;YACtC,YAAY,GAAG,YAAY,EAAE,CAAC;YAC9B,YAAY,MAAM,WAAW,CAAC,MAAM,CAAC;gBAAC;gBAAU;aAAQ,EAAE;gBACxD,QAAQ,MAAM,WAAW,CAAC,MAAM,CAAC,OAAO;gBACxC,UAAU,MAAM,WAAW,CAAC,QAAQ,CAAC,cAAc;YACrD;QACF,CAAC;IACH,CAAC;AAED,MAAM,eAAe,IAAA,2NAAM,EAAC,OAAO,CAAC,EAAE,KAAK,EAAE,GAAK,CAAC;QACjD,SAAS;QACT,YAAY;QACZ,SAAS,MAAM,OAAO,CAAC,GAAG;QAC1B,WAAW;QACX,gBAAgB;QAChB,UAAS;IACX,CAAC;AAEc,SAAS,UAAU,EAAE,QAAQ,EAAkC;IAC5E,MAAM,WAAW,IAAA,wKAAW;IAC5B,MAAM,SAAS,IAAA,wKAAW,EAAC,CAAC,QAAqB,MAAM,MAAM,CAAC,MAAM;IACpE,MAAM,WAAW,IAAA,wKAAW,EAAC,CAAC,QAAqB,MAAM,MAAM,CAAC,QAAQ;IACxE,MAAM,UAAU,IAAA,wKAAW,EAAC,CAAC,QAAqB,MAAM,MAAM,CAAC,OAAO;IACtE,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,IAAA,4JAAU;IACpC,MAAM,kBAAkB;IACxB,MAAM,YAAY;IAClB,MAAM,YAAY,SAAS,MAAM,aAAa;IAC9C,MAAM,cAAc,YAAY,UAAU,MAAM,CAAC,GAAG,WAAW,KAAK;IAEpE,4DAA4D;IAC5D,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAc,IAAI;IAEhE,MAAM,eAAe;QACnB,SAAS,SAAS,IAAA,sKAAW,OAAM,SAAS,IAAA,qKAAU;IACxD;IAEA,MAAM,mBAAmB,CAAC;QACxB,OAAO,IAAI,CAAC;IAEd;IAEA,MAAM,eAAe,CAAC;QACpB,eAAe,CAAA;YACb,MAAM,OAAO,IAAI,IAAI;YACrB,IAAI,KAAK,GAAG,CAAC,SAAS,KAAK,MAAM,CAAC;iBAC7B,KAAK,GAAG,CAAC;YACd,OAAO;QACT;IACF;IAEA,MAAM,CAAC,MAAM,QAAQ,GAAG,gNAAK,CAAC,QAAQ,CAAC;IAEvC,MAAM,kBAAkB;QACtB,QAAQ;IACV;IAEA,IAAA,kNAAS,EAAC;QACR,MAAM,aAAa,YAAY;YAC7B,IAAI,CAAC,iBAAiB;gBACpB;YACF;QACF,GAAG;QACH,OAAO;YACL,cAAc;QAChB;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,sBAAsB;QAC1B,OAAO,IAAI,CAAC;IACd;IAEA,qBACE;;0BACE,sPAAC,2MAAM;gBACL,MAAM;gBACN,mBAAgB;gBAChB,oBAAiB;;kCAEjB,sPAAC,+NAAW;wBAAC,IAAG;kCACb;;;;;;kCAEH,sPAAC,uOAAa;kCACZ,cAAA,sPAAC,uPAAiB;4BAAC,IAAG;sCAA2B;;;;;;;;;;;kCAInD,sPAAC,uOAAa;kCACZ,cAAA,sPAAC,2MAAM;4BAAC,SAAS;4BAAqB,SAAS;sCAAC;;;;;;;;;;;;;;;;;0BAKpD,sPAAC,iKAAG;gBAAC,IAAI;oBAAE,SAAS;gBAAO;;kCACzB,sPAAC;wBACC,UAAS;wBACT,MAAM;wBACN,WAAW;wBACX,IAAI;4BACF,iBAAiB;4BACjB,cAAc;4BACd,gBAAgB;4BAChB,OAAO;wBACT;kCAEA,cAAA,sPAAC,yKAAO;4BAAC,IAAI;gCAAE,gBAAgB;gCAAiB,WAAW;oCAAE,IAAI;oCAAI,IAAI;gCAAG;4BAAE;;8CAE5E,sPAAC,+KAAU;oCACT,OAAM;oCACN,cAAW;oCACX,SAAS;oCACT,MAAK;oCACL,MAAK;oCACL,IAAI;wCAAE,OAAO;oCAAQ;8CAErB,cAAA,sPAAC,oKAAQ;;;;;;;;;;8CAIX,sPAAC,iKAAG;oCAAC,IAAI;wCAAE,SAAS;wCAAQ,YAAY;wCAAU,KAAK;oCAAI;;wCACxD,iCACC,sPAAC,uKAAM;4CACL,IAAI;gDACF,SAAS;gDACT,OAAO;gDACP,OAAO;gDACP,QAAQ;gDACR,UAAU;4CAEZ;sDAEC;;;;;;sDAGL,sPAAC,+KAAU;4CAAC,OAAM;4CAAU,SAAS,IAAM,IAAA,yJAAO,EAAC;oDAAE,aAAa;gDAAO;sDACvE,cAAA,sPAAC,sKAAM;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAQf,sPAAC,uKAAM;wBACL,IAAI;4BACF,OAAO;4BACP,YAAY;4BACZ,sBAAsB;gCACpB,OAAO;gCACP,iBAAiB;gCACjB,OAAO;gCACP,WAAW;4BAEb;wBACF;wBACA,SAAQ;wBACR,QAAO;wBACP,MAAM;wBACN,YAAY;4BAAE,aAAa;wBAAK;;0CAEhC,sPAAC;gCAAa,IAAI;oCAAE,iBAAiB;oCAA4B,YAAY;gCAAO;0CACjF;;;;;;0CAEH,sPAAC,yKAAO;gCAAC,IAAI;oCAAE,aAAa;gCAAyB;;;;;;0CAErD,sPAAC,mKAAI;gCAAC,IAAI;oCAAE,OAAO;oCAAQ,UAAU;oCAAG,GAAG;oCACzC,yBAAyB;wCACvB,UAAS;oCACX;gCAEF;0CACG,SAAS,GAAG,CAAC,CAAC;oCACb,MAAM,SAAS,OAAO,KAAK,OAAO;oCAClC,MAAM,OAAO,QAAQ,MAAM,CAAC,CAAA,MAAO,OAAO,IAAI,SAAS,MAAM;oCAC7D,MAAM,cAAc,KAAK,MAAM,GAAG;oCAClC,MAAM,aAAa,YAAY,GAAG,CAAC;oCAEnC,qBACE,sPAAC,gNAAK,CAAC,QAAQ;;0DAEb,sPAAC,2KAAQ;gDAAC,cAAc;0DACtB,cAAA,sPAAC,uLAAc;oDACb,SAAS;wDACP,IAAI,aAAa;4DACf,aAAa;wDACf,OAAO;4DACL,iBAAiB,KAAK,GAAG;wDAC3B;oDACF;oDACA,IAAI;wDACF,WAAW;4DACT,iBAAiB;wDACnB;oDACF;;sEAGA,sPAAC,mLAAY;4DAAC,SAAS,KAAK,SAAS;;;;;;wDACpC,eAAe,CACd,2BAAa,sPAAC,0KAAU;;;;iFAAM,sPAAC,0KAAU;;;;gEAC3C;;;;;;;;;;;;4CAKH,6BACC,sPAAC,2KAAQ;gDAAC,IAAI;gDAAY,SAAQ;gDAAO,aAAa;0DACpD,cAAA,sPAAC,mKAAI;oDAAC,cAAc;8DACjB,KAAK,GAAG,CAAC,CAAC,oBACT,sPAAC,2KAAQ;4DAAmB,cAAc;sEACxC,cAAA,sPAAC,uLAAc;gEACb,IAAI;oEACF,IAAI;oEACJ,WAAW;wEACT,iBAAiB;oEACnB;oEACA,gBAAgB;gEAClB;gEACA,SAAS,IAAM,iBAAiB,IAAI,GAAG;0EAEvC,cAAA,sPAAC,mLAAY;oEAAC,SAAS,IAAI,SAAS;;;;;;;;;;;2DAXzB,IAAI,OAAO;;;;;;;;;;;;;;;;uCA9Bf;;;;;gCAkDzB;;;;;;;;;;;;kCAOJ,sPAAC;wBAAK,MAAM;;0CACV,sPAAC,iKAAG;gCAAC,IAAI;oCAAE,WAAW;gCAAG;;;;;;4BACxB;;;;;;;;;;;;;;;AAKX"}}]
}